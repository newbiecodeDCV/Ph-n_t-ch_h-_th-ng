# REVIEW THI·∫æT K·∫æ H·ªÜ TH·ªêNG AI QA CALL SCORING

**Ng∆∞·ªùi review:** System Architect  
**Ng√†y:** 11/10/2025  
**T√†i li·ªáu review:** 13_SYSTEM_DESIGN_THEO_CASE_CHUAN.md + c√°c t√†i li·ªáu li√™n quan

---

## 1. T·ªîNG QUAN ƒê√ÅNH GI√Å

### 1.1. ƒê·ªô ph√π h·ª£p v·ªõi y√™u c·∫ßu

D·ª±a tr√™n 2 use case ch√≠nh t·ª´ ·∫£nh:
1. **Ki·ªÉm tra tu√¢n th·ªß c·∫≠p nh·∫≠t CRM c·ªßa Sales/CSKH** ‚úÖ
2. **ƒê√°nh gi√° ch·∫•m ƒëi·ªÉm cu·ªôc g·ªçi c·ªßa Sales trao ƒë·ªïi v·ªõi KH** ‚úÖ

**K·∫øt lu·∫≠n:** Thi·∫øt k·∫ø ƒë√£ **ƒê√ÅP ·ª®NG ƒê·∫¶Y ƒê·ª¶** c·∫£ 2 use case v·ªõi:
- CASE 1: CRM Compliance (Ki·ªÉm tra tu√¢n th·ªß CRM)
- CASE 2: Call Scoring & Coaching (ƒê√°nh gi√° ch·∫•m ƒëi·ªÉm cu·ªôc g·ªçi)

### 1.2. ƒêi·ªÉm m·∫°nh c·ªßa thi·∫øt k·∫ø

| Ti√™u ch√≠ | ƒê√°nh gi√° | Chi ti·∫øt |
|----------|----------|----------|
| **T√≠nh to√†n di·ªán** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Bao ph·ªß ƒë·∫ßy ƒë·ªß 2 CASE, c√≥ ki·∫øn tr√∫c r√µ r√†ng |
| **T√≠nh chi ti·∫øt** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Code m·∫´u, database schema, API specs ƒë·∫ßy ƒë·ªß |
| **T√≠nh kh·∫£ thi** | ‚≠ê‚≠ê‚≠ê‚≠ê | C√≥ gi·∫£i ph√°p cold start khi ch∆∞a c√≥ baseline |
| **T√≠nh m·ªü r·ªông** | ‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê | Microservices, horizontal scaling, monitoring |
| **T√≠nh th·ª±c ti·ªÖn** | ‚≠ê‚≠ê‚≠ê‚≠ê | Docker compose, deployment guides c√≥ s·∫µn |

---

## 2. MAPPING V·ªöI Y√äU C·∫¶U T·ª™ ·∫¢NH

### 2.1. Use Case 1: Ki·ªÉm tra tu√¢n th·ªß c·∫≠p nh·∫≠t CRM

| Y√™u c·∫ßu (t·ª´ ·∫£nh) | Thi·∫øt k·∫ø hi·ªán t·∫°i | ƒê√°nh gi√° |
|------------------|-------------------|----------|
| **AI t·ª± ƒë·ªông ph√°t hi·ªán l·ªói & c·∫£nh b√°o nh·∫Øc nh·ªü** | ‚úÖ CASE 1 v·ªõi Rules Engine ph√°t hi·ªán vi ph·∫°m M1/M2/M3 | ƒê√°p ·ª©ng |
| **AI t·ª± ƒë·ªông qu√©t rules** | ‚úÖ C√≥ h·ªá th·ªëng Rules Engine v·ªõi thresholds c√≥ th·ªÉ c·∫•u h√¨nh | ƒê√°p ·ª©ng |
| **T·∫°o b·ªô l·ªçc, xu·∫•t d·ªØ li·ªáu** | ‚úÖ Database schema h·ªó tr·ª£ query v√† filter | ƒê√°p ·ª©ng |
| **Ra so√°t tu√¢n th·ªß ph√°t hi·ªán l·ªói sai** | ‚úÖ Detection rate, False positive <5% | ƒê√°p ·ª©ng |
| **T·ª± ƒë·ªông nh·∫Øc nh·ªü Sales/CSKH s·ª≠a l·ªói** | ‚úÖ Reminders system v·ªõi due_at, status tracking | ƒê√°p ·ª©ng |
| **T·ªïng h·ª£p b√°o c√°o th·ªëng k√™ l·ªói** | ‚úÖ Reports aggregation, views for reporting | ƒê√°p ·ª©ng |

### 2.2. Use Case 2: ƒê√°nh gi√° ch·∫•m ƒëi·ªÉm cu·ªôc g·ªçi

| Y√™u c·∫ßu (t·ª´ ·∫£nh) | Thi·∫øt k·∫ø hi·ªán t·∫°i | ƒê√°nh gi√° |
|------------------|-------------------|----------|
| **AI ch·∫•m ƒëi·ªÉm & ƒë√°nh gi√° cu·ªôc g·ªçi** | ‚úÖ CASE 2 v·ªõi KNGT + KNBH evaluation (0-10 ƒëi·ªÉm) | ƒê√°p ·ª©ng t·ªët |
| **T√≥m t·∫Øt n·ªôi dung Voice ‚Üí Gi√∫p view nhanh** | ‚úÖ Executive summary 3-5 c√¢u + highlights | ƒê√°p ·ª©ng t·ªët |
| **ƒê√°nh gi√° ch·∫•m ƒëi·ªÉm theo checklist** | ‚úÖ 7 criteria KNGT + 7 criteria KNBH v·ªõi weights r√µ r√†ng | ƒê√°p ·ª©ng xu·∫•t s·∫Øc |
| **ƒê·ªÅ xu·∫•t c·∫£i thi·ªán theo ng·ªØ c·∫£nh** | ‚úÖ Context-aware recommendations v·ªõi actionable messages | ƒê√°p ·ª©ng t·ªët |
| **G·ª£i √Ω k·ªãch b·∫£n giao ti·∫øp m·∫´u ƒë·ªÉ tham kh·∫£o** | ‚úÖ Suggested scripts by stage v·ªõi when_to_use guides | ƒê√°p ·ª©ng t·ªët |

---

## 3. PH√ÇN T√çCH CHI TI·∫æT C√ÅC TH√ÄNH PH·∫¶N

### 3.1. CASE 1: CRM Compliance (NTT - 10% ƒëi·ªÉm)

**ƒêi·ªÉm m·∫°nh:**
- ‚úÖ T√°ch bi·ªát r√µ r√†ng v·ªõi CASE 2 (ƒë·ªôc l·∫≠p module)
- ‚úÖ C√≥ h·ªá th·ªëng vi ph·∫°m M1/M2/M3 r√µ r√†ng
- ‚úÖ Integration point v·ªõi CASE 2 ƒë·ªÉ t√≠nh ƒëi·ªÉm t·ªïng

**C·∫ßn b·ªï sung:**
- ‚ö†Ô∏è Chi ti·∫øt v·ªÅ Rules Engine cho CRM compliance
- ‚ö†Ô∏è Workflow nh·∫Øc nh·ªü v√† escalation
- ‚ö†Ô∏è C∆° ch·∫ø filter v√† export data

**ƒê·ªÅ xu·∫•t c·∫£i thi·ªán:**
```python
class CRMComplianceChecker:
    """
    CASE 1: Ki·ªÉm tra tu√¢n th·ªß CRM
    """
    
    RULES = {
        "update_time": {
            "max_delay_hours": 24,
            "violation_levels": {
                "M1": (24, 48),    # 1-2 ng√†y
                "M2": (48, 72),    # 2-3 ng√†y
                "M3": (72, None)   # >3 ng√†y
            }
        },
        "required_fields": [
            "contact_outcome",
            "next_action",
            "notes"
        ],
        "minimum_note_length": 50
    }
    
    def check_compliance(self, call_id: str, crm_record: Dict) -> Dict:
        violations = []
        
        # Check update time
        delay_hours = self._calculate_delay(call_id, crm_record)
        if delay_hours > self.RULES["update_time"]["max_delay_hours"]:
            violations.append(self._classify_violation(delay_hours))
        
        # Check required fields
        for field in self.RULES["required_fields"]:
            if not crm_record.get(field):
                violations.append({
                    "type": "missing_field",
                    "field": field,
                    "level": "M2"
                })
        
        # Check note quality
        if len(crm_record.get("notes", "")) < self.RULES["minimum_note_length"]:
            violations.append({
                "type": "insufficient_notes",
                "level": "M1"
            })
        
        return {
            "compliant": len(violations) == 0,
            "violations": violations,
            "score_impact": self._calculate_score_impact(violations)
        }
```

### 3.2. CASE 2: Call Scoring (KNGT + KNBH - 90% ƒëi·ªÉm)

**ƒêi·ªÉm m·∫°nh:**
- ‚úÖ Ph√¢n chia r√µ r√†ng KNGT (K·ªπ nƒÉng giao ti·∫øp) v√† KNBH (K·ªπ nƒÉng b√°n h√†ng)
- ‚úÖ Dynamic weights theo call type (BH/CSKH) 
- ‚úÖ Call Type Detection t·ª´ audio (kh√¥ng c·∫ßn CRM)
- ‚úÖ Speech Rate evaluation chi ti·∫øt v·ªõi cold start strategy
- ‚úÖ Customer Impact ∆∞u ti√™n cao

**ƒêi·ªÉm xu·∫•t s·∫Øc:**
- üåü **Cold Start Strategy:** Gi·∫£i quy·∫øt v·∫•n ƒë·ªÅ kh√¥ng c√≥ baseline ban ƒë·∫ßu
- üåü **Context-aware:** Kh√¥ng ph·∫°t trong ng·ªØ c·∫£nh h·ª£p l√Ω (ƒë·ªçc OTP, KH y√™u c·∫ßu)
- üåü **Evidence Generation:** Timestamps + quotes c·ª• th·ªÉ

### 3.3. Speech Rate Evaluation (Ti√™u ch√≠ SR)

**Ph√¢n t√≠ch ƒë·ªô s√¢u:**
Thi·∫øt k·∫ø Speech Rate ƒë√£ r·∫•t chi ti·∫øt v·ªõi:
- ‚úÖ Segmentation theo speaker + pause (5-15s segments)
- ‚úÖ VAD ƒë·ªÉ x√°c ƒë·ªãnh pause d√†i (‚â•700ms)
- ‚úÖ WPM calculation lo·∫°i tr·ª´ silence
- ‚úÖ Customer Impact detection (y√™u c·∫ßu nh·∫Øc l·∫°i)
- ‚úÖ Absolute thresholds khi ch∆∞a c√≥ baseline

**Ng∆∞·ª°ng c·ª• th·ªÉ:**
| Call Type | Qu√° ch·∫≠m | Ch·∫≠m | T·ªët | Nhanh | Qu√° nhanh |
|-----------|----------|------|-----|-------|-----------|
| BH | <100 | 100-130 | 130-180 | 180-220 | >220 wpm |
| CSKH | <90 | 90-120 | 120-170 | 170-210 | >210 wpm |

---

## 4. KI·∫æN TR√öC & C√îNG NGH·ªÜ

### 4.1. Architecture Review

```
Strengths:
‚úÖ Microservices architecture ‚Üí Scalable
‚úÖ Message Queue (RabbitMQ) ‚Üí Async processing
‚úÖ Redis Cache ‚Üí Performance
‚úÖ PostgreSQL + Views ‚Üí Reporting ready
‚úÖ S3/MinIO ‚Üí Audio storage
‚úÖ Prometheus + Grafana ‚Üí Monitoring

Weaknesses:
‚ö†Ô∏è Kh√¥ng c√≥ API Gateway chi ti·∫øt (ch·ªâ mention Kong/Nginx)
‚ö†Ô∏è Thi·∫øu Authentication/Authorization details
‚ö†Ô∏è Ch∆∞a c√≥ CI/CD pipeline
```

### 4.2. Technology Stack

| Layer | Technology | Ph√π h·ª£p? |
|-------|------------|----------|
| API | FastAPI | ‚úÖ Excellent choice (async, auto-docs) |
| Queue | Celery + RabbitMQ | ‚úÖ Mature, reliable |
| Database | PostgreSQL 14+ | ‚úÖ Perfect for structured data |
| Cache | Redis 7+ | ‚úÖ Standard choice |
| STT | Whisper/Google STT | ‚úÖ Good options |
| VAD | Silero VAD | ‚úÖ Lightweight, CPU-only |
| Monitoring | Prometheus + Grafana | ‚úÖ Industry standard |

---

## 5. GAP ANALYSIS

### 5.1. Nh·ªØng g√¨ ƒë√£ l√†m t·ªët

1. **Comprehensive Design:** Bao ph·ªß ƒë·∫ßy ƒë·ªß 2 use cases
2. **Production Ready:** C√≥ Docker compose, deployment guides
3. **Scalable Architecture:** Microservices, horizontal scaling
4. **Smart Solutions:** Cold start strategy, context-aware rules
5. **Detailed Implementation:** Code m·∫´u, database schema chi ti·∫øt

### 5.2. Nh·ªØng g√¨ c·∫ßn b·ªï sung

| Gap | Priority | ƒê·ªÅ xu·∫•t |
|-----|----------|---------|
| **CRM Rules Engine chi ti·∫øt** | High | Th√™m module rules configuration |
| **Reminder Workflow** | High | Design notification service |
| **Export/Filter mechanism** | Medium | API endpoints cho export Excel/CSV |
| **Authentication/Authorization** | High | JWT + RBAC implementation |
| **CI/CD Pipeline** | Medium | GitLab CI ho·∫∑c GitHub Actions |
| **Load Testing** | Low | Locust test scenarios |
| **Backup & Recovery** | Medium | Database backup strategy |

### 5.3. ƒê·ªÅ xu·∫•t b·ªï sung cho Use Case 1

```yaml
# crm-compliance-service.yaml
apiVersion: v1
kind: Service
metadata:
  name: crm-compliance-service
spec:
  components:
    rules-engine:
      description: "Qu√©t v√† ki·ªÉm tra rules tu√¢n th·ªß"
      features:
        - Configurable rules per team/department
        - Real-time violation detection
        - Batch processing for historical data
    
    reminder-service:
      description: "T·ª± ƒë·ªông nh·∫Øc nh·ªü agent"
      features:
        - Email/SMS/In-app notifications
        - Escalation matrix (Agent ‚Üí Supervisor ‚Üí Manager)
        - Reminder frequency configuration
        - Snooze/Acknowledge tracking
    
    reporting-service:
      description: "B√°o c√°o v√† export"
      features:
        - Daily/Weekly/Monthly aggregation
        - Export to Excel/CSV/PDF
        - Drill-down by team/agent/time
        - Trend analysis and predictions
```

---

## 6. RISK ASSESSMENT

### 6.1. Technical Risks

| Risk | Impact | Likelihood | Mitigation |
|------|--------|------------|------------|
| **STT accuracy cho ti·∫øng Vi·ªát** | High | Medium | D√πng multiple STT engines, ensemble |
| **False positive cao** | Medium | Medium | Customer Impact priority, human review |
| **Latency v∆∞·ª£t 5s** | Medium | Low | Caching, parallel processing |
| **Baseline drift** | Low | Medium | Weekly baseline update (ƒë√£ c√≥) |

### 6.2. Business Risks

| Risk | Impact | Mitigation |
|------|--------|------------|
| **Agent resistance** | High | Training, gradual rollout, feedback loop |
| **Over-reliance on AI** | Medium | Human QA sampling 10-20% |
| **Privacy concerns** | High | Data encryption, access control, audit logs |

---

## 7. K·∫æT LU·∫¨N & KHUY·∫æN NGH·ªä

### 7.1. T·ªïng quan ƒë√°nh gi√°

**ƒêi·ªÉm s·ªë t·ªïng th·ªÉ: 8.5/10** üåü

Thi·∫øt k·∫ø ƒë√£:
- ‚úÖ **ƒê√°p ·ª©ng ƒë·∫ßy ƒë·ªß** c·∫£ 2 use cases t·ª´ y√™u c·∫ßu
- ‚úÖ **Chi ti·∫øt v√† kh·∫£ thi** cho implementation
- ‚úÖ **C√≥ gi·∫£i ph√°p th√¥ng minh** cho c√°c v·∫•n ƒë·ªÅ th·ª±c t·∫ø (cold start, context-aware)
- ‚úÖ **Production-ready** v·ªõi monitoring, deployment guides

### 7.2. Khuy·∫øn ngh·ªã tri·ªÉn khai

#### Phase 1: MVP (Sprint 1-2)
1. **CASE 2 - Core Scoring:** KNGT + KNBH evaluation
2. **Speech Rate v·ªõi cold start:** D√πng absolute thresholds
3. **Basic API:** Score submission + result retrieval

#### Phase 2: Enhancement (Sprint 3-4)  
1. **CASE 1 - CRM Compliance:** Rules engine + reminders
2. **Summary & Recommendations:** LLM integration
3. **Dashboard:** Real-time monitoring

#### Phase 3: Optimization (Sprint 5-6)
1. **Baseline calculation:** T·ª´ d·ªØ li·ªáu t√≠ch l≈©y
2. **Export/Reporting:** Advanced analytics
3. **Performance tuning:** Caching, optimization

### 7.3. Success Metrics

| Metric | Target | Measure |
|--------|--------|---------|
| **Scoring Accuracy** | MAE ‚â§ 1.0 | Weekly validation vs manual QA |
| **Processing Speed** | <5s per call | P95 latency monitoring |
| **CRM Compliance Rate** | >85% | Daily compliance reports |
| **False Positive Rate** | <5% | Agent feedback tracking |
| **System Availability** | 99.9% | Uptime monitoring |

### 7.4. Final Recommendation

**‚úÖ APPROVE thi·∫øt k·∫ø v·ªõi ƒëi·ªÅu ki·ªán:**

1. B·ªï sung chi ti·∫øt CRM Rules Engine (CASE 1)
2. Th√™m Reminder/Notification service design
3. Clarify Authentication/Authorization strategy
4. Document data export/filter APIs

**Thi·∫øt k·∫ø n√†y ƒë√£ s·∫µn s√†ng cho development phase v·ªõi c√°c b·ªï sung nh·ªè n√™u tr√™n.**

---

## 8. NEXT STEPS

1. **Immediate (Week 1):**
   - [ ] Finalize CRM Rules Engine specification
   - [ ] Setup development environment (Docker)
   - [ ] Create project structure and repositories

2. **Short-term (Week 2-4):**
   - [ ] Implement CASE 2 core (KNGT + KNBH)
   - [ ] Develop Speech Rate evaluator with cold start
   - [ ] Setup database and basic APIs

3. **Medium-term (Week 5-8):**
   - [ ] Implement CASE 1 (CRM Compliance)
   - [ ] Integrate STT service
   - [ ] Deploy to staging environment

4. **Long-term (Week 9-12):**
   - [ ] Performance optimization
   - [ ] User training and documentation
   - [ ] Production deployment

---

**Reviewed by:** System Architect  
**Date:** 11/10/2025  
**Status:** ‚úÖ **APPROVED WITH CONDITIONS**

---

## PH·ª§ L·ª§C: CHECKLIST REVIEW

### Technical Checklist
- [x] Architecture design ph√π h·ª£p
- [x] Database schema ƒë·∫ßy ƒë·ªß
- [x] API specification r√µ r√†ng
- [x] Performance targets kh·∫£ thi
- [x] Monitoring & logging adequate
- [x] Security considerations
- [ ] Authentication details (c·∫ßn b·ªï sung)
- [ ] CI/CD pipeline (c·∫ßn b·ªï sung)

### Business Checklist
- [x] ƒê√°p ·ª©ng Use Case 1 (CRM Compliance)
- [x] ƒê√°p ·ª©ng Use Case 2 (Call Scoring)
- [x] ROI justifiable
- [x] Scalability cho growth
- [x] Training plan outlined
- [ ] Change management plan (c·∫ßn b·ªï sung)

### Compliance Checklist
- [x] Data privacy addressed
- [x] Audit trail capability
- [ ] GDPR/Legal compliance (c·∫ßn review)
- [ ] Disaster recovery plan (c·∫ßn b·ªï sung)